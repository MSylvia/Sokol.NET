version: 2
jobs:
  build:
    docker:
      - image: mcr.microsoft.com/dotnet/core/sdk:3.0
    environment:
      DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1
      DOTNET_CLI_TELEMETRY_OPTOUT: 1
    steps:
      - checkout
      - run:
          name: "Git Submodules"
          command: git submodule update --init --recursive
      - run:
          name: Restore
          command: dotnet restore ./src/Sokol.sln --verbosity m
      - run:
          name: Build
          command: dotnet publish ./src/Sokol.Graphics/Sokol.Graphics.csproj --no-restore -c Release
      - run:
          name: Build Tests
          command: dotnet build ./**/*.Tests.csproj --no-restore --verbosity m -c Debug
      - run:
          name: Run Tests
          command: dotnet test ./**/*.Tests.csproj --no-build --verbosity n -c Debug